<!DOCTYPE html>
<html lang="nl" 
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(~{::title}, ~{::section})}">
<head>
    <title>Mijn Inschrijvingen - Inschrijvingen SNH</title>
</head>
<body>
    <section class="wizard-container">
        <div class="container">
            <div class="form-card">
                <h1 class="form-title">Mijn Inschrijvingen</h1>
                
                <!-- Email Info Box -->
                <div class="info-box info-box--primary mb-4">
                    <h2 class="info-box__title">‚úâÔ∏è Uw e-mailadres</h2>
                    <p class="info-box__text">
                        <strong th:text="${email}">email@voorbeeld.be</strong>
                    </p>
                </div>

                <!-- Pending Registration Alert (if exists) -->
                <div th:if="${pendingRegistration != null}" class="info-box info-box--warning mb-4">
                    <h2 class="info-box__title">‚ö†Ô∏è Lopende inschrijving</h2>
                    <p class="info-box__text">
                        U heeft een inschrijving die nog niet voltooid is voor 
                        <strong th:text="${pendingRegistration.studentFirstname != null ? (pendingRegistration.studentFirstname + ' ' + pendingRegistration.studentLastname) : 'een leerling'}">Naam Leerling</strong>.
                    </p>
                    <p class="info-box__text">
                        Klik op "Inschrijving afwerken" om verder te gaan.
                    </p>
                </div>

                <!-- Registrations Table -->
                <div style="margin: 2rem 0;">
                    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">
                        Bestaande Inschrijvingen
                    </h2>

                    <table style="width: 100%; border-collapse: collapse; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #f9f9f9; border-bottom: 2px solid #ddd;">
                                <th style="padding: 1rem; text-align: left; font-weight: 600;">Leerling</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600;">Studierichting</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600;">Schooljaar</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600;">Status</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600;">Actie</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="reg : ${registrations}" 
                                style="border-bottom: 1px solid #ddd;"
                                th:style="${reg.status.name() == 'PENDING'} ? 'background-color: #fff3cd; border-bottom: 1px solid #ddd;' : 'border-bottom: 1px solid #ddd;'">
                                <td style="padding: 1rem;">
                                    <strong th:if="${reg.studentFirstname != null and reg.studentLastname != null}"
                                            th:text="${reg.studentFirstname} + ' ' + ${reg.studentLastname}">
                                        Naam Leerling
                                    </strong>
                                    <span th:if="${reg.studentFirstname == null or reg.studentLastname == null}"
                                          style="color: #6c757d; font-style: italic;">
                                        Nog in te vullen
                                    </span>
                                </td>
                                <td style="padding: 1rem;">
                                    <div th:if="${reg.selectedStudyYear != null}">
                                        <div th:text="${reg.selectedStudyYear + 'e jaar'}" style="font-weight: 600; margin-bottom: 0.25rem;"></div>
                                        <div th:if="${studyProgramNames[reg.id] != null}" 
                                             th:text="${studyProgramNames[reg.id]}"
                                             style="font-size: 0.875rem; color: #6c757d;"></div>
                                        <span th:if="${studyProgramNames[reg.id] == null}" 
                                              style="font-size: 0.875rem; color: #6c757d; font-style: italic;">
                                            Nog te kiezen
                                        </span>
                                    </div>
                                    <span th:if="${reg.selectedStudyYear == null}" style="color: #6c757d; font-style: italic;">Nog niet gekozen</span>
                                </td>
                                <td style="padding: 1rem;" th:text="${reg.schoolYear}">2025-2026</td>
                                <td style="padding: 1rem;">
                                    <span th:if="${reg.status.name() == 'COMPLETED'}" 
                                          class="badge" 
                                          style="background-color: #28a745; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem;">
                                        ‚úÖ Voltooid
                                    </span>
                                    <span th:if="${reg.status.name() == 'PENDING'}" 
                                          class="badge" 
                                          style="background-color: #ffc107; color: #000; padding: 0.25rem 0.75rem; border-radius: 0.25rem;">
                                        ‚è≥ Lopend
                                    </span>
                                </td>
                                <td style="padding: 1rem;">
                                    <div th:if="${reg.status.name() == 'PENDING'}" style="display: flex; gap: 0.5rem;">
                                        <a th:href="@{/inschrijving/continue/{id}(id=${reg.id})}" 
                                           class="btn btn--outline"
                                           style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                                            üìù Afwerken
                                        </a>
                                        <button type="button"
                                                class="btn btn--danger btn-delete"
                                                th:data-registration-id="${reg.id}"
                                                th:data-student-name="${reg.studentFirstname != null ? reg.studentFirstname + ' ' + reg.studentLastname : 'deze inschrijving'}"
                                                style="padding: 0.5rem 1rem; font-size: 0.875rem; background-color: #dc3545; color: white; border: 1px solid #dc3545;">
                                            üóëÔ∏è Verwijderen
                                        </button>
                                    </div>
                                    <button th:if="${reg.status.name() == 'COMPLETED'}"
                                            type="button"
                                            class="btn btn--icon"
                                            title="Download PDF"
                                            style="padding: 0.5rem 0.75rem; background-color: transparent; border: 1px solid #6c757d; border-radius: 0.25rem; cursor: pointer; font-size: 1.25rem; color: #dc3545;">
                                        <i class="fa-solid fa-file-pdf"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- New Registration Button -->
                <div class="form-actions" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #ddd;">
                    <a th:href="@{/inschrijving/nieuw}" class="btn btn--primary" style="width: 100%; justify-content: center;">
                        <svg class="btn__icon btn__icon--left" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 4v8M4 8h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Nieuwe leerling inschrijven
                    </a>
                </div>
            </div>
        </div>
    </section>
    
    <style>
        table tbody tr:hover {
            background-color: #f5f5f5;
        }
    </style>
    
    <script>
        // Add event listeners to delete buttons
        document.addEventListener('DOMContentLoaded', function() {
            const deleteButtons = document.querySelectorAll('.btn-delete');
            
            deleteButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const registrationId = this.getAttribute('data-registration-id');
                    const studentName = this.getAttribute('data-student-name');
                    
                    const message = 'Bent u zeker dat u de inschrijving van ' + studentName + ' wilt verwijderen?\n\nDeze actie kan niet ongedaan gemaakt worden.';
                    
                    if (confirm(message)) {
                        window.location.href = '/inschrijving/verwijderen/' + registrationId;
                    }
                });
            });
        });
    </script>
</body>
</html>
